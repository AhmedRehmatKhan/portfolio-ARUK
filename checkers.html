<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Checkers - Play Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 900px;
            width: 100%;
        }

        .game-modes {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .mode-btn:not(.active) {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .mode-btn:not(.active):hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .connection-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .connection-panel.hidden {
            display: none;
        }

        .connection-options {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .connection-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            min-width: 200px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .connection-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .connection-card.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .room-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .room-input input {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
            text-transform: uppercase;
        }

        .room-input button {
            padding: 12px 25px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .join-btn {
            background: #28a745;
        }

        .join-btn:hover {
            background: #218838;
        }

        .create-btn {
            background: #007bff;
        }

        .create-btn:hover {
            background: #0056b3;
        }

        .game-status {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 15px;
            border-left: 5px solid #2196f3;
        }

        .game-status h3 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 1.4rem;
        }

        .game-status p {
            color: #666;
            font-size: 1.1rem;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: start;
        }

        .player-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .player-panel.active {
            background: linear-gradient(135deg, #e3f2fd, #f0f4ff);
            border: 2px solid #2196f3;
            transform: scale(1.02);
        }

        .player-panel h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2196f3;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .captured-pieces {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            min-height: 40px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-top: 10px;
        }

        .captured-piece {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .board-container {
            display: flex;
            justify-content: center;
            position: relative;
        }

        .checkers-board {
            display: grid;
            grid-template-columns: repeat(8, 65px);
            grid-template-rows: repeat(8, 65px);
            gap: 2px;
            background: #8B4513;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .board-coordinates {
            position: absolute;
            color: #8B4513;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .coord-numbers {
            left: -25px;
            top: 15px;
            display: flex;
            flex-direction: column;
            height: calc(8 * 67px);
            justify-content: space-around;
            align-items: center;
        }

        .coord-letters {
            bottom: -25px;
            left: 15px;
            display: flex;
            width: calc(8 * 67px);
            justify-content: space-around;
            align-items: center;
        }

        .square {
            width: 65px;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .square.light {
            background: #F5DEB3;
        }

        .square.dark {
            background: #8B4513;
        }

        .square.highlighted {
            background: #FFD700 !important;
            box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.8);
            animation: pulse 1s infinite;
        }

        .square.possible-move {
            background: #90EE90 !important;
            box-shadow: inset 0 0 15px rgba(144, 238, 144, 0.8);
        }

        .square.last-move {
            background: #FFA500 !important;
            box-shadow: inset 0 0 10px rgba(255, 165, 0, 0.6);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .piece {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #333;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .piece.red {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #dc3545);
        }

        .piece.black {
            background: radial-gradient(circle at 30% 30%, #495057, #212529);
        }

        .piece.king::after {
            content: '♔';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: gold;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .piece:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .piece.selected {
            transform: scale(1.2);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.9);
            animation: selectedPulse 0.8s infinite;
        }

        @keyframes selectedPulse {
            0%, 100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.9); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 1); }
        }

        .move-history {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .move-history h5 {
            margin-bottom: 10px;
            color: #333;
        }

        .move-item {
            padding: 5px 10px;
            margin: 2px 0;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .reset-btn {
            background: #dc3545;
            color: white;
        }

        .reset-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }



        .difficulty-selector {
            margin: 20px 0;
            text-align: center;
        }

        .difficulty-selector select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-waiting {
            background: #fff3cd;
            color: #856404;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .player-panel {
                max-width: 400px;
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .checkers-board {
                grid-template-columns: repeat(8, 50px);
                grid-template-rows: repeat(8, 50px);
                padding: 10px;
            }
            
            .square {
                width: 50px;
                height: 50px;
            }
            
            .piece {
                width: 38px;
                height: 38px;
            }
            
            .game-modes {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-btn {
                min-width: 200px;
            }
            
            .connection-options {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏁 Buddy Checkers</h1>
        <p>Challenge friends online or test your skills against our AI!</p>
    </div>

    <div class="game-container">
        <div class="game-modes">
            <button class="mode-btn active" onclick="setGameMode('friend')">👥 Play with Friend</button>
            <button class="mode-btn" onclick="setGameMode('bot')">🤖 Play with Bot</button>
        </div>

        <div class="connection-panel" id="connectionPanel">
            <h3>🔗 Connect with Your Friend</h3>
            <p>Choose how you want to connect and play together!</p>
            
            <div class="connection-options">
                <div class="connection-card active" onclick="selectConnectionType('create')">
                    <h4>🎯 Create Room</h4>
                    <p>Start a new game and invite a friend</p>
                </div>
                <div class="connection-card" onclick="selectConnectionType('join')">
                    <h4>🚪 Join Room</h4>
                    <p>Enter a friend's room code</p>
                </div>
            </div>
            
            <div class="room-input">
                <input type="text" id="roomCode" placeholder="Enter room code (e.g., GAME123)" maxlength="10">
                <button class="join-btn" onclick="joinRoom()">Join Room</button>
                <button class="create-btn" onclick="createRoom()">Create New Room</button>
            </div>
            
            <div id="roomStatus" style="margin-top: 15px; font-weight: 600;"></div>
            <div id="shareSection" style="display: none; margin-top: 15px; padding: 15px; background: #e8f5e8; border-radius: 10px;">
                <h4 style="margin-bottom: 10px; color: #155724;">📤 Share with Friend</h4>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: center;">
                    <input type="text" id="shareLink" readonly style="flex: 1; min-width: 250px; padding: 10px; border: 2px solid #28a745; border-radius: 5px; background: white; font-family: monospace;">
                    <button onclick="copyShareLink()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">📋 Copy Link</button>
                    <button onclick="shareViaEmail()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">📧 Email</button>
                </div>
                <p style="margin-top: 8px; font-size: 0.9rem; color: #666; text-align: center;">Send this link to your friend so they can join instantly!</p>
            </div>
            <div id="connectionStatus" class="connection-status status-disconnected">
                <span>⚫</span> Not Connected
            </div>
        </div>

        <div class="difficulty-selector" id="difficultySelector" style="display: none;">
            <label for="botDifficulty">🤖 Bot Difficulty: </label>
            <select id="botDifficulty" onchange="setBotDifficulty()">
                <option value="easy">Easy - Random moves</option>
                <option value="medium" selected>Medium - Smart moves</option>
                <option value="hard">Hard - Strategic play</option>
            </select>
        </div>

        <div class="game-status">
            <h3 id="gameTitle">🎮 Ready to Play!</h3>
            <p id="gameMessage">Choose your game mode and start playing!</p>
        </div>

        <div class="game-layout">
            <div class="player-panel active" id="player1Panel">
                <h4>🔴 Player 1 (Red)</h4>
                <div class="player-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="redCount">12</div>
                        <div class="stat-label">Pieces</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="redKings">0</div>
                        <div class="stat-label">Kings</div>
                    </div>
                </div>
                <div class="captured-pieces" id="redCaptured"></div>
                <div class="move-history" id="redHistory">
                    <h5>Recent Moves</h5>
                    <div id="redMoves"></div>
                </div>
            </div>

            <div class="board-container">
                <div class="board-coordinates coord-numbers">
                    <div>8</div><div>7</div><div>6</div><div>5</div><div>4</div><div>3</div><div>2</div><div>1</div>
                </div>
                <div class="board-coordinates coord-letters">
                    <div>A</div><div>B</div><div>C</div><div>D</div><div>E</div><div>F</div><div>G</div><div>H</div>
                </div>
                <div class="checkers-board" id="board"></div>
            </div>

            <div class="player-panel" id="player2Panel">
                <h4 id="player2Title">⚫ Player 2 (Black)</h4>
                <div class="player-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="blackCount">12</div>
                        <div class="stat-label">Pieces</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="blackKings">0</div>
                        <div class="stat-label">Kings</div>
                    </div>
                </div>
                <div class="captured-pieces" id="blackCaptured"></div>
                <div class="move-history" id="blackHistory">
                    <h5>Recent Moves</h5>
                    <div id="blackMoves"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn reset-btn" onclick="resetGame()">🔄 New Game</button>
        </div>
    </div>

    <script>
        class CheckersGame {
            constructor() {
                this.board = [];
                this.currentPlayer = 'red';
                this.selectedPiece = null;
                this.gameMode = 'friend';
                this.botDifficulty = 'medium';
                this.roomCode = null;
                this.isConnected = false;
                this.connectionType = 'create';
                this.redPieces = 12;
                this.blackPieces = 12;
                this.redKings = 0;
                this.blackKings = 0;
                this.gameActive = true;
                this.moveHistory = [];
                this.lastMove = null;
                
                this.initializeBoard();
                this.renderBoard();
                this.updateUI();
            }

            initializeBoard() {
                this.board = Array(8).fill().map(() => Array(8).fill(null));
                
                // Place red pieces (bottom)
                for (let row = 5; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        if ((row + col) % 2 === 1) {
                            this.board[row][col] = { color: 'red', king: false };
                        }
                    }
                }
                
                // Place black pieces (top)
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 8; col++) {
                        if ((row + col) % 2 === 1) {
                            this.board[row][col] = { color: 'black', king: false };
                        }
                    }
                }
            }

            renderBoard() {
                const boardElement = document.getElementById('board');
                boardElement.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                        square.dataset.row = row;
                        square.dataset.col = col;
                        
                        
                        
                        const piece = this.board[row][col];
                        if (piece) {
                            const pieceElement = document.createElement('div');
                            pieceElement.className = `piece ${piece.color} ${piece.king ? 'king' : ''}`;
                            square.appendChild(pieceElement);
                        }
                        
                        square.addEventListener('click', (e) => this.handleSquareClick(row, col, e));
                        boardElement.appendChild(square);
                    }
                }
            }

            handleSquareClick(row, col, event) {
                if (!this.gameActive) return;
                
                // If playing with bot and it's bot's turn, ignore clicks
                if (this.gameMode === 'bot' && this.currentPlayer === 'black') return;
                
                const piece = this.board[row][col];
                
                if (this.selectedPiece) {
                    // Try to move selected piece
                    if (this.isValidMove(this.selectedPiece.row, this.selectedPiece.col, row, col)) {
                        const wasJump = Math.abs(row - this.selectedPiece.row) === 2;
                        this.makeMove(this.selectedPiece.row, this.selectedPiece.col, row, col);
                        
                        // Check for additional jumps if this was a jump
                        if (wasJump && this.gameActive) {
                            const additionalJumps = this.getJumpMoves(row, col);
                            if (additionalJumps.length > 0) {
                                // Continue with same piece for multi-jump
                                this.selectPiece(row, col);
                                this.updateGameMessage('Multi-jump available! Continue jumping with the same piece.');
                                return;
                            }
                        }
                        
                        this.clearSelection();
                        this.switchPlayer();
                        
                        // Bot's turn
                        if (this.gameMode === 'bot' && this.currentPlayer === 'black' && this.gameActive) {
                            setTimeout(() => this.makeBotMove(), 1200);
                        }
                    } else {
                        this.clearSelection();
                        // Select new piece if clicked on own piece and no forced jumps
                        if (piece && piece.color === this.currentPlayer) {
                            const forcedJumps = this.getForcedJumps(this.currentPlayer);
                            if (forcedJumps.length === 0 || forcedJumps.some(jump => jump.fromRow === row && jump.fromCol === col)) {
                                this.selectPiece(row, col);
                            }
                        }
                    }
                } else {
                    // Select piece if it belongs to current player
                    if (piece && piece.color === this.currentPlayer) {
                        const forcedJumps = this.getForcedJumps(this.currentPlayer);
                        // Only allow selection if no forced jumps or this piece can jump
                        if (forcedJumps.length === 0 || forcedJumps.some(jump => jump.fromRow === row && jump.fromCol === col)) {
                            this.selectPiece(row, col);
                        }
                    }
                }
            }

            selectPiece(row, col) {
                this.selectedPiece = { row, col };
                this.highlightPossibleMoves(row, col);
                this.renderBoard();
                
                // Highlight selected piece
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                square.classList.add('highlighted');
                square.querySelector('.piece').classList.add('selected');
                
                // Highlight pieces that must jump
                this.highlightForcedJumps();
            }

            highlightForcedJumps() {
                const forcedJumps = this.getForcedJumps(this.currentPlayer);
                if (forcedJumps.length > 0) {
                    forcedJumps.forEach(jump => {
                        const square = document.querySelector(`[data-row="${jump.fromRow}"][data-col="${jump.fromCol}"]`);
                        if (square && !square.classList.contains('highlighted')) {
                            square.style.boxShadow = 'inset 0 0 15px rgba(255, 0, 0, 0.6)';
                        }
                    });
                }
            }

            clearSelection() {
                this.selectedPiece = null;
                this.renderBoard();
            }

            highlightPossibleMoves(row, col) {
                const moves = this.getPossibleMoves(row, col);
                moves.forEach(move => {
                    const square = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                    square.classList.add('possible-move');
                });
            }

            getPossibleMoves(row, col) {
                const piece = this.board[row][col];
                if (!piece) return [];
                
                // Check for forced jumps first
                const jumpMoves = this.getJumpMoves(row, col);
                const forcedJumps = this.getForcedJumps(piece.color);
                
                // If there are forced jumps for this player, only return jumps for this piece
                if (forcedJumps.length > 0) {
                    return jumpMoves;
                }
                
                // Otherwise return all possible moves
                const moves = [];
                const directions = piece.king ? 
                    [[-1, -1], [-1, 1], [1, -1], [1, 1]] : 
                    piece.color === 'red' ? [[-1, -1], [-1, 1]] : [[1, -1], [1, 1]];
                
                directions.forEach(([dRow, dCol]) => {
                    const newRow = row + dRow;
                    const newCol = col + dCol;
                    
                    if (this.isValidMove(row, col, newRow, newCol)) {
                        moves.push({ row: newRow, col: newCol });
                    }
                    
                    // Check for jumps
                    const jumpRow = row + dRow * 2;
                    const jumpCol = col + dCol * 2;
                    
                    if (this.isValidMove(row, col, jumpRow, jumpCol)) {
                        moves.push({ row: jumpRow, col: jumpCol });
                    }
                });
                
                return moves;
            }

            getJumpMoves(row, col) {
                const piece = this.board[row][col];
                if (!piece) return [];
                
                const jumpMoves = [];
                const directions = piece.king ? 
                    [[-1, -1], [-1, 1], [1, -1], [1, 1]] : 
                    piece.color === 'red' ? [[-1, -1], [-1, 1]] : [[1, -1], [1, 1]];
                
                directions.forEach(([dRow, dCol]) => {
                    const jumpRow = row + dRow * 2;
                    const jumpCol = col + dCol * 2;
                    
                    if (this.isValidMove(row, col, jumpRow, jumpCol)) {
                        jumpMoves.push({ row: jumpRow, col: jumpCol });
                    }
                });
                
                return jumpMoves;
            }

            getForcedJumps(color) {
                const forcedJumps = [];
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.color === color) {
                            const jumpMoves = this.getJumpMoves(row, col);
                            jumpMoves.forEach(move => {
                                forcedJumps.push({
                                    fromRow: row,
                                    fromCol: col,
                                    toRow: move.row,
                                    toCol: move.col
                                });
                            });
                        }
                    }
                }
                return forcedJumps;
            }

            isValidMove(fromRow, fromCol, toRow, toCol) {
                // Check bounds
                if (toRow < 0 || toRow >= 8 || toCol < 0 || toCol >= 8) return false;
                
                // Check if destination is empty
                if (this.board[toRow][toCol]) return false;
                
                // Check if destination is on dark square
                if ((toRow + toCol) % 2 === 0) return false;
                
                const piece = this.board[fromRow][fromCol];
                if (!piece) return false;
                
                const rowDiff = toRow - fromRow;
                const colDiff = toCol - fromCol;
                
                // Regular move (one square diagonally)
                if (Math.abs(rowDiff) === 1 && Math.abs(colDiff) === 1) {
                    if (piece.king) return true;
                    if (piece.color === 'red' && rowDiff < 0) return true;
                    if (piece.color === 'black' && rowDiff > 0) return true;
                    return false;
                }
                
                // Jump move (two squares diagonally)
                if (Math.abs(rowDiff) === 2 && Math.abs(colDiff) === 2) {
                    const middleRow = fromRow + rowDiff / 2;
                    const middleCol = fromCol + colDiff / 2;
                    const middlePiece = this.board[middleRow][middleCol];
                    
                    if (middlePiece && middlePiece.color !== piece.color) {
                        if (piece.king) return true;
                        if (piece.color === 'red' && rowDiff < 0) return true;
                        if (piece.color === 'black' && rowDiff > 0) return true;
                    }
                }
                
                return false;
            }

            makeMove(fromRow, fromCol, toRow, toCol) {
                const piece = this.board[fromRow][fromCol];
                this.board[toRow][toCol] = piece;
                this.board[fromRow][fromCol] = null;
                
                let capturedPiece = null;
                const rowDiff = toRow - fromRow;
                const colDiff = toCol - fromCol;
                
                // Handle jumps
                if (Math.abs(rowDiff) === 2) {
                    const middleRow = fromRow + rowDiff / 2;
                    const middleCol = fromCol + colDiff / 2;
                    capturedPiece = this.board[middleRow][middleCol];
                    
                    if (capturedPiece) {
                        this.board[middleRow][middleCol] = null;
                        this.addCapturedPiece(capturedPiece.color);
                        
                        if (capturedPiece.color === 'red') {
                            this.redPieces--;
                            if (capturedPiece.king) this.redKings--;
                        } else {
                            this.blackPieces--;
                            if (capturedPiece.king) this.blackKings--;
                        }
                    }
                }
                
                // Check for king promotion
                const wasKing = piece.king;
                if ((piece.color === 'red' && toRow === 0) || 
                    (piece.color === 'black' && toRow === 7)) {
                    if (!piece.king) {
                        piece.king = true;
                        if (piece.color === 'red') this.redKings++;
                        else this.blackKings++;
                    }
                }
                
                // Record move
                this.lastMove = { fromRow, fromCol, toRow, toCol };
                this.addMoveToHistory(fromRow, fromCol, toRow, toCol, capturedPiece, !wasKing && piece.king);
                
                this.updateUI();
                this.checkGameEnd();
            }

            switchPlayer() {
                this.currentPlayer = this.currentPlayer === 'red' ? 'black' : 'red';
                this.updateUI();
            }

            updateGameMessage(message) {
                document.getElementById('gameMessage').textContent = message;
            }

            addMoveToHistory(fromRow, fromCol, toRow, toCol, captured, promoted) {
                const from = String.fromCharCode(65 + fromCol) + (8 - fromRow);
                const to = String.fromCharCode(65 + toCol) + (8 - toRow);
                
                let moveText = `${from} → ${to}`;
                if (captured) moveText += ' (captured)';
                if (promoted) moveText += ' (king!)';
                
                this.moveHistory.push({
                    player: this.currentPlayer,
                    text: moveText,
                    timestamp: new Date().toLocaleTimeString()
                });
                
                // Keep only last 5 moves per player
                if (this.moveHistory.length > 10) {
                    this.moveHistory.shift();
                }
                
                this.updateMoveHistory();
            }

            updateMoveHistory() {
                const redMoves = document.getElementById('redMoves');
                const blackMoves = document.getElementById('blackMoves');
                
                redMoves.innerHTML = '';
                blackMoves.innerHTML = '';
                
                this.moveHistory.forEach(move => {
                    const moveElement = document.createElement('div');
                    moveElement.className = 'move-item';
                    moveElement.textContent = move.text;
                    
                    if (move.player === 'red') {
                        redMoves.appendChild(moveElement);
                    } else {
                        blackMoves.appendChild(moveElement);
                    }
                });
            }

            addCapturedPiece(color) {
                const capturedContainer = color === 'red' ? 
                    document.getElementById('blackCaptured') : 
                    document.getElementById('redCaptured');
                
                const capturedPiece = document.createElement('div');
                capturedPiece.className = `captured-piece ${color}`;
                capturedPiece.style.background = color === 'red' ? 
                    'radial-gradient(circle at 30% 30%, #ff6b6b, #dc3545)' : 
                    'radial-gradient(circle at 30% 30%, #495057, #212529)';
                
                capturedContainer.appendChild(capturedPiece);
            }

            makeBotMove() {
                this.performBotMoveSequence();
            }

            performBotMoveSequence() {
                const botMoves = this.getAllPossibleMoves('black');
                if (botMoves.length === 0) {
                    this.endGame('red');
                    return;
                }
                
                let selectedMove;
                
                switch (this.botDifficulty) {
                    case 'easy':
                        selectedMove = botMoves[Math.floor(Math.random() * botMoves.length)];
                        break;
                    case 'medium':
                        // Prefer jumps, then random
                        const jumpMoves = botMoves.filter(move => Math.abs(move.toRow - move.fromRow) === 2);
                        selectedMove = jumpMoves.length > 0 ? 
                            jumpMoves[Math.floor(Math.random() * jumpMoves.length)] :
                            botMoves[Math.floor(Math.random() * botMoves.length)];
                        break;
                    case 'hard':
                        // Strategic: prioritize jumps, king moves, center control
                        selectedMove = this.getBestMove(botMoves);
                        break;
                }
                
                const wasJump = Math.abs(selectedMove.toRow - selectedMove.fromRow) === 2;
                this.makeMove(selectedMove.fromRow, selectedMove.fromCol, selectedMove.toRow, selectedMove.toCol);
                this.renderBoard();
                
                // Check for additional jumps if this was a jump
                if (wasJump && this.gameActive) {
                    const additionalJumps = this.getJumpMoves(selectedMove.toRow, selectedMove.toCol);
                    if (additionalJumps.length > 0) {
                        // Continue with multi-jump after a delay
                        setTimeout(() => {
                            this.performBotMoveSequence();
                        }, 800);
                        return;
                    }
                }
                
                // Switch to player's turn
                this.switchPlayer();
            }

            getBestMove(moves) {
                let bestMove = moves[0];
                let bestScore = -1000;
                
                moves.forEach(move => {
                    let score = 0;
                    
                    // Prioritize jumps
                    if (Math.abs(move.toRow - move.fromRow) === 2) score += 100;
                    
                    // Prefer king moves
                    const piece = this.board[move.fromRow][move.fromCol];
                    if (piece.king) score += 20;
                    
                    // Prefer center control
                    if (move.toRow >= 2 && move.toRow <= 5 && move.toCol >= 2 && move.toCol <= 5) score += 10;
                    
                    // Prefer advancing
                    score += move.toRow * 2;
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = move;
                    }
                });
                
                return bestMove;
            }

            getAllPossibleMoves(color) {
                const moves = [];
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const piece = this.board[row][col];
                        if (piece && piece.color === color) {
                            const pieceMoves = this.getPossibleMoves(row, col);
                            pieceMoves.forEach(move => {
                                moves.push({
                                    fromRow: row,
                                    fromCol: col,
                                    toRow: move.row,
                                    toCol: move.col
                                });
                            });
                        }
                    }
                }
                return moves;
            }



            updateUI() {
                document.getElementById('redCount').textContent = this.redPieces;
                document.getElementById('blackCount').textContent = this.blackPieces;
                document.getElementById('redKings').textContent = this.redKings;
                document.getElementById('blackKings').textContent = this.blackKings;
                
                // Update active player panels
                const player1Panel = document.getElementById('player1Panel');
                const player2Panel = document.getElementById('player2Panel');
                
                if (this.currentPlayer === 'red') {
                    player1Panel.classList.add('active');
                    player2Panel.classList.remove('active');
                } else {
                    player1Panel.classList.remove('active');
                    player2Panel.classList.add('active');
                }
                
                // Update game status
                const gameTitle = document.getElementById('gameTitle');
                const gameMessage = document.getElementById('gameMessage');
                
                if (this.gameActive) {
                    gameTitle.textContent = `${this.currentPlayer === 'red' ? '🔴' : '⚫'} ${this.currentPlayer.charAt(0).toUpperCase() + this.currentPlayer.slice(1)}'s Turn`;
                    
                    // Check for forced jumps
                    const forcedJumps = this.getForcedJumps(this.currentPlayer);
                    
                    if (this.gameMode === 'bot') {
                        if (this.currentPlayer === 'red') {
                            if (forcedJumps.length > 0) {
                                gameMessage.textContent = 'You must jump! Click a piece that can capture.';
                            } else {
                                gameMessage.textContent = 'Your turn! Click a piece to move.';
                            }
                        } else {
                            gameMessage.textContent = 'Bot is thinking...';
                        }
                    } else {
                        if (forcedJumps.length > 0) {
                            gameMessage.textContent = `${this.currentPlayer.charAt(0).toUpperCase() + this.currentPlayer.slice(1)} player must jump! Click a piece that can capture.`;
                        } else {
                            gameMessage.textContent = `${this.currentPlayer.charAt(0).toUpperCase() + this.currentPlayer.slice(1)} player, make your move!`;
                        }
                    }
                }
            }

            checkGameEnd() {
                if (this.redPieces === 0) {
                    this.endGame('black');
                } else if (this.blackPieces === 0) {
                    this.endGame('red');
                } else {
                    // Check if current player has any moves
                    const possibleMoves = this.getAllPossibleMoves(this.currentPlayer);
                    if (possibleMoves.length === 0) {
                        this.endGame(this.currentPlayer === 'red' ? 'black' : 'red');
                    }
                }
            }

            endGame(winner) {
                this.gameActive = false;
                const gameTitle = document.getElementById('gameTitle');
                const gameMessage = document.getElementById('gameMessage');
                
                gameTitle.textContent = `🎉 ${winner.charAt(0).toUpperCase() + winner.slice(1)} Wins!`;
                
                if (this.gameMode === 'bot') {
                    gameMessage.textContent = winner === 'red' ? 
                        'Congratulations! You defeated the bot!' : 
                        'Bot wins! Better luck next time!';
                } else {
                    gameMessage.textContent = 'Congratulations! Click "New Game" to play again.';
                }
            }

            reset() {
                this.board = [];
                this.currentPlayer = 'red';
                this.selectedPiece = null;
                this.redPieces = 12;
                this.blackPieces = 12;
                this.redKings = 0;
                this.blackKings = 0;
                this.gameActive = true;
                this.moveHistory = [];
                this.lastMove = null;
                
                // Clear captured pieces and move history
                document.getElementById('redCaptured').innerHTML = '';
                document.getElementById('blackCaptured').innerHTML = '';
                document.getElementById('redMoves').innerHTML = '';
                document.getElementById('blackMoves').innerHTML = '';
                
                this.initializeBoard();
                this.renderBoard();
                this.updateUI();
            }
        }

        // Global game instance
        let game = new CheckersGame();

        // Game mode functions
        function setGameMode(mode) {
            game.gameMode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide panels
            const connectionPanel = document.getElementById('connectionPanel');
            const difficultySelector = document.getElementById('difficultySelector');
            const hintBtn = document.getElementById('hintBtn');
            
            if (mode === 'friend') {
                connectionPanel.classList.remove('hidden');
                difficultySelector.style.display = 'none';
                document.getElementById('player2Title').textContent = '⚫ Player 2 (Black)';
            } else {
                connectionPanel.classList.add('hidden');
                difficultySelector.style.display = 'block';
                document.getElementById('player2Title').textContent = '🤖 Bot (Black)';
            }
            
            resetGame();
        }

        function selectConnectionType(type) {
            game.connectionType = type;
            
            // Update card states
            document.querySelectorAll('.connection-card').forEach(card => card.classList.remove('active'));
            event.target.classList.add('active');
            
            const roomInput = document.getElementById('roomCode');
            if (type === 'create') {
                roomInput.placeholder = 'Room will be generated...';
                roomInput.disabled = true;
            } else {
                roomInput.placeholder = 'Enter room code (e.g., GAME123)';
                roomInput.disabled = false;
            }
        }

        function setBotDifficulty() {
            game.botDifficulty = document.getElementById('botDifficulty').value;
        }

        // Room functions (simulated for demo)
        function createRoom() {
            const roomCode = 'ROOM' + Math.random().toString(36).substr(2, 4).toUpperCase();
            document.getElementById('roomCode').value = roomCode;
            document.getElementById('roomStatus').innerHTML = `
                <div style="color: #28a745; font-size: 1.1rem;">✅ Room Created Successfully!</div>
                <div style="margin-top: 8px;">Room Code: <strong>${roomCode}</strong></div>
                <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">Use the share options below to invite your friend!</div>
            `;
            
            // Show share section and generate link
            const shareSection = document.getElementById('shareSection');
            const shareLink = document.getElementById('shareLink');
            const gameUrl = window.location.origin + window.location.pathname + '?room=' + roomCode;
            shareLink.value = gameUrl;
            shareSection.style.display = 'block';
            
            updateConnectionStatus('waiting', 'Waiting for friend to join...');
            game.roomCode = roomCode;
            
            // Simulate friend joining after a delay (for demo)
            setTimeout(() => {
                updateConnectionStatus('connected', `Connected to ${roomCode}`);
                game.isConnected = true;
            }, 3000);
        }

        function joinRoom() {
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            if (roomCode.length < 4) {
                document.getElementById('roomStatus').innerHTML = `
                    <div style="color: #dc3545;">❌ Please enter a valid room code</div>
                `;
                return;
            }
            
            document.getElementById('roomStatus').innerHTML = `
                <div style="color: #28a745; font-size: 1.1rem;">✅ Successfully Joined!</div>
                <div style="margin-top: 8px;">Connected to room: <strong>${roomCode}</strong></div>
                <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">You can now play with your friend!</div>
            `;
            
            updateConnectionStatus('connected', `Connected to ${roomCode}`);
            game.roomCode = roomCode;
            game.isConnected = true;
        }

        function updateConnectionStatus(status, message) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.className = `connection-status status-${status}`;
            
            const statusIcons = {
                connected: '🟢',
                waiting: '🟡',
                disconnected: '⚫'
            };
            
            statusElement.innerHTML = `<span>${statusIcons[status]}</span> ${message}`;
        }

        function resetGame() {
            game.reset();
        }

        // Share functions
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                // Show success feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ Copied!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#28a745';
                }, 2000);
            } catch (err) {
                // Fallback for browsers that don't support execCommand
                alert('Please manually copy this link: ' + shareLink.value);
            }
        }

        function shareViaEmail() {
            const roomCode = game.roomCode;
            const shareLink = document.getElementById('shareLink').value;
            const subject = encodeURIComponent('Join my Checkers game!');
            const body = encodeURIComponent(`Hi! I've created a checkers game room and would love to play with you.

Room Code: ${roomCode}
Direct Link: ${shareLink}

Click the link above or go to the game and enter the room code to join!

Let's play! 🏁`);
            
            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
            window.open(mailtoLink);
        }

        // Check for room parameter in URL on page load
        function checkForRoomInUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomCode = urlParams.get('room');
            
            if (roomCode) {
                // Auto-fill room code and switch to join mode
                document.getElementById('roomCode').value = roomCode.toUpperCase();
                selectConnectionType('join');
                
                // Show notification
                document.getElementById('roomStatus').innerHTML = `
                    <div style="color: #007bff; font-size: 1.1rem;">🔗 Room link detected!</div>
                    <div style="margin-top: 8px;">Room Code: <strong>${roomCode.toUpperCase()}</strong></div>
                    <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">Click "Join Room" to connect with your friend!</div>
                `;
            }
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            setGameMode('friend');
            selectConnectionType('create');
            checkForRoomInUrl();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964b969b731c03e8',t:'MTc1MzQ0NTc4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>




